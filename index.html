<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
	<title>VALO in Space</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

	<!-- Tailwind -->
	<!-- <link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet"> -->




	<!-- Dependencies: JQuery and GMaps API should be loaded first -->
	<script src="js/jquery-2.1.1.min.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCyrJDHTdAiCLZqF0XgLP_PA0d7gmVEoAA&sensor=false"></script>



	<link rel="stylesheet" type="text/css" href="css/valo-space.css"/>
	<script src="js/jquery-gmaps-latlon-picker.js"></script>
	<!-- <script src="js/valo-scripts.js"></script> -->
	<style>
		.grid-container {
    display: grid;
}

.grid-container--fill {
    grid-template-columns: repeat(auto-fill, minmax(500px, 1fr));
}

.grid-container--fit {
    grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
}

.grid-element {
  
  padding: 20px;
}

	</style>

	<script>		
	</script>
</head>

<!-- aria-label="LONG" -->

<!-- AJAX Request sent to -->
<!-- https://script.google.com/macros/s/AKfycbx3vNK9UjmmDV7toGNM9I7J6DuccAYsXlBAbxaj3GoUS-Rup7c/exec -->

<body class="stars" >
	<div class="page-hide ">
			<div class="grid-container grid-container--fit">
					<div class="grid-element">
						<img src="https://images.ctfassets.net/wfptrcrbtkd0/5ChXBRW6l5GGEUBe7JNJOT/ac99c96f070732d4f1e32bd149f76400/Valo_Logo_White_2019.svg" class="logo">
						<h1> Can you guess where the <span style="font-weight: 700;">VALO<sup>&trade;</sup></span> light landed?</h1>
						<p>2019 marks the VALO curing light’s 10th anniversary, and to celebrate, we sent a VALO light into space! Guess where it landed for your chance to win a FREE VALO light! Just click where you think it landed on the map below and then enter in your office information. Whoever guesses the closest location wins a VALO curing light!</p>

						</div>
			</div>
			<fieldset class="gllpLatlonPicker">
					
					<div class="grid-container grid-container--fit">
							<div class="grid-element">
									<div onclick="showMap()" class ="instructions ">
											<img src="Images/Map_Gif_Instructions_V2.gif" style="width:100%;">
										</div>
									<div  class="gllpMap is-hidden ">Google Maps</div>

									<p onclick="showMapInstructions()" class="SeeMap is-hidden button">See Map Instructions Again</p>

									<p> 1. The form autopopulates “lat & Long” from the map so no need to fill it in once you pick from the map.
											<br><br>
											2.  The Marker starts at Lift-off
											<br><br>
											3. Hint: Stay west of the Mississippi river & east of California</p>
									<br><br>
									<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>

									<br/>
				
							</div>
							<div class="grid-element">
									<div class="form-container">
											<form name="submit-to-google-sheet">
												<p class="form-title">Email</p>
												<input id="userEmail" name="email" type="email" placeholder="Email" required>
												<p class="form-title">First Name</p>
												<input name="firstName" type="text" placeholder="First Name" required>
												<p class="form-title">Last Name</p>
												<input name="lastName" type="text" placeholder="Last Name" required>
				
												<div class="form-map">
														<p class="form-title">Latitude</p>
														<input class="gllpLatitude" name="LAT" value="40.5657534" type="text" placeholder="Lattitude" required>
														<p class="form-title">Longitude</p>
														<input class="gllpLongitude" value="-111.9062161" name="LONG" type="text" placeholder="Longitude" required>
				
														<input  type="button" class="gllpUpdateButton" value="update map">
												</div>
											
												<p class="form-title">Office</p>
												<p class="form-title"></p>
												<input name="office" type="text" placeholder="Office Name" required>
												<p class="form-title">City</p>
												<input name="city" type="text" placeholder="city" required>
												<p class="form-title">State</p>
												<input name="state" type="text" placeholder="State" required>
												<p class="form-title">Country</p>
												<!-- <input name="country" type="text" placeholder="Country" required> -->
												<select class="select-country"  name="country" required>
														<option value="United Ststes of America">United Ststes of America</option>
														<option value="Brazil">Brazil</option>
													</select>
													<br>
													<input style="width: auto;" type="checkbox" name="agree" value="Car" required
													oninvalid="this.setCustomValidity('Please agree to terms and services')"
													oninput="setCustomValidity('')"
													> I agree to the <a href="#">Terms and Service</a> of the contest<br>
												<input style="display: none;" type="text" class="gllpZoom" value="7"/>
												<button id="submit" class="button" type="submit">Submit</button>
											</form>
									
											<div class="loading js-loading is-hidden">
												<div class="loading-spinner">
													<svg><circle cx="25" cy="25" r="20" fill="none" stroke-width="2" stroke-miterlimit="10"/></svg>
												</div>
											</div>
									
											<!-- <p class="js-success-message is-hidden form-message">Success!</p> -->
											<!-- <p class="js-error-message is-hidden form-message">Error!</p>
											<p class="js-error-duplicate is-hidden form-message">Sorry only one entry per person! You can have 3 diffrent people from the same office enter just be sure to use a diffrent email per entry.</p> -->
										</div>
							</div>
						 
						</div>
	
			</fieldset>
	</div>
	
		

	<!-- Success Message -->
		<div class="js-success-message is-hidden"  id="center">

				<div id="main">
						<div>
								<h1>Thank You!</h1>
							
									
									
								<p>We’ve recorded your pin drop!</p>
										<p>Does someone else in your office have a guess?*</p>
										<p><a class="link-button" href="https://www.ultradent.com/products/categories/equipment/curing-lights">Shop VALO</a><a class="link-button" href="https://brooklee1.github.io/valo-to-Space/"> Guess again</a></p>
										<p>*Each office can submit up to three entries. One entry per person.</p>
								<br/>
						</div>
						</div>
						
					 
					</div>

				<div class="js-error-duplicate is-hidden" id="center">

				<div id="main">
						<div>
							<img src="https://images.ctfassets.net/wfptrcrbtkd0/5ChXBRW6l5GGEUBe7JNJOT/ac99c96f070732d4f1e32bd149f76400/Valo_Logo_White_2019.svg" class="logo">
							<h1>Oh No!</h1>
							<p class="center">Sorry only one entry per person! You can have 3 diffrent people from the same office enter just be sure to use a diffrent email per entry.</p>
							<br>
							<br>
							<p class="center"><a class="link-button" href="https://www.ultradent.com/products/categories/equipment/curing-lights">Shop VALO</a><a class="link-button" href="https://brooklee1.github.io/valo-to-Space/">Try Again</a></p>
							<br>
							<br>
							</div>
				</div>

				
		</div>

					

				<!-- <div class="">
						<div class="space-content">
								<div
								class="w-full float-none sm:float-left px-4 pt-8 pb-0 sm:py-8 mx-0 ">
								<div>
										<h1>Thank You!</h1>
										<p>We’ve recorded your pin drop!</p>
										<p>Does someone else in your office have a guess?*</p>
										<p class="mt-8 mb-8"><a class="link-button" href="https://www.ultradent.com/products/categories/equipment/curing-lights">Shop VALO</a><a class="link-button" href="https://brooklee1.github.io/valo-to-Space/"> Guess again</a></p>
										<p>*Each office can submit up to three entries. One entry per person.</p>
						
								</div>
						</div>
						</div>
					</div> -->
		</div>
		<!-- General Error -->
		<div class="js-error is-hidden"  id="center">

				<div id="main">
						<div>
							<img src="https://images.ctfassets.net/wfptrcrbtkd0/5ChXBRW6l5GGEUBe7JNJOT/ac99c96f070732d4f1e32bd149f76400/Valo_Logo_White_2019.svg" class="logo">
							<h1> Oh No!</h1>
							<p class="center">there was a problem submitting your entry please try submitting again later!</p>
							<br>
							<br>
							<p class="center"><a class="link-button" href="https://www.ultradent.com/products/categories/equipment/curing-lights">Shop VALO</a><a class="link-button" href="https://brooklee1.github.io/valo-to-Space/">Try Again</a></p>
							</div>
				</div>

				
		</div>

			<!-- One entry Error -->

			

			<!-- <div class="outter js-error-duplicate is-hidden">

					<div class="middle grid-container grid-container--fit">
							<div class="inner grid-element">
								<img src="https://images.ctfassets.net/wfptrcrbtkd0/5ChXBRW6l5GGEUBe7JNJOT/ac99c96f070732d4f1e32bd149f76400/Valo_Logo_White_2019.svg" class="logo">
								<h1> Oh No!</h1>
								<p class="center">Sorry only one entry per person! You can have 3 diffrent people from the same office enter just be sure to use a diffrent email per entry.</p>
								<br>
								<br>
								<p class="center"><a class="link-button" href="https://www.ultradent.com/products/categories/equipment/curing-lights">Shop VALO</a><a class="link-button" href="https://brooklee1.github.io/valo-to-Space/">Try Again</a></p>
								</div>
					</div>

					
			</div> -->

		
		
		



	

	

		<!-- <fieldset class="gllpLatlonPicker">
				<br/><br/>
				<div class="gllpMap">Google Maps</div>
				<br/>
				<div class="info">
						Lat:
						<input type="text" class="gllpLatitude" value="40.5657534"/>
						Long:
						<input type="text" class="gllpLongitude" value="-111.9062161"/>
					<input style="display: none;" type="text" class="gllpZoom" value="7"/>
					<input  type="button" class="gllpUpdateButton" value="update map">
				</div>
				
			</fieldset> -->

			<!-- <fieldset class="gllpLatlonPicker">
				<br/><br/>
				<div class="gllpMap">Google Maps</div>
				<br/>
				<div class="rocket">
						<div class="form-container">
								<form name="submit-to-google-sheet">
									<p class="form-title">Email</p>
									<input id="userEmail" name="email" type="email" placeholder="Email" required>
									<p class="form-title">First Name</p>
									<input name="firstName" type="text" placeholder="First Name" required>
									<p class="form-title">Last Name</p>
									<input name="lastName" type="text" placeholder="Last Name" required>

									<div class="form-map">
											<p class="form-title">Latitude</p>
											<input class="gllpLatitude" name="LAT" value="40.5657534" type="text" placeholder="Lattitude" required>
											<p class="form-title">Longitude</p>
											<input class="gllpLongitude" value="-111.9062161" name="LONG" type="text" placeholder="Longitude" required>

											<input  type="button" class="gllpUpdateButton" value="update map">
									</div>
								
									<p class="form-title">Office</p>
									<p class="form-title"></p>
									<input name="office" type="text" placeholder="Office Name" required>
									<p class="form-title">City</p>
									<input name="city" type="text" placeholder="city" required>
									<p class="form-title">State</p>
									<input name="state" type="text" placeholder="State" required>
									<p class="form-title">Country</p>
									<input name="country" type="text" placeholder="Country" required>
									<input style="display: none;" type="text" class="gllpZoom" value="7"/>
									<button id="submit" class="button" type="submit">Submit</button>
								</form>
						
								<div class="loading js-loading is-hidden">
									<div class="loading-spinner">
										<svg><circle cx="25" cy="25" r="20" fill="none" stroke-width="2" stroke-miterlimit="10"/></svg>
									</div>
								</div>
						
								<p class="js-success-message is-hidden form-message">Success!</p>
								<p class="js-error-message is-hidden form-message">Error!</p>
								<p class="js-error-duplicate is-hidden form-message">Sorry only one entry per person! You can have 3 diffrent people from the same office enter just be sure to use a diffrent email per entry.</p>
							</div>
			
							 <a href="https://docs.google.com/spreadsheets/d/1Q7OrRTByqyPn2sInibfRSkfTN1QtTolZTwR07L2QG3E/edit?usp=sharing" target="_blank">View the Google Sheet</a> -->
							<!-- <a href="https://github.com/jamiewilson/form-to-google-sheets" target="_blank">View on GitHub</a> -->
						
							<!-- <div>
								<img class="rocket-ship" src="Images/Illustration_Valo_to_Space_RocketShip_Landing_Page_Q4_2019.svg"
							</div> -->

							<!-- <div class="results"> results will go here</div>  -->

				<!-- </div> -->
				

			<!-- </fieldset> --> 

		

				

					<script>
						const scriptURL = 'https://script.google.com/macros/s/AKfycbyI8Xr6LKoFPmV2c1eq6SR-2WDcAcTIBFxjX8XH5BBlKQGOst4/exec'
						const form = document.forms['submit-to-google-sheet']
						const page = document.querySelector('.page-hide')
						const loading = document.querySelector('.js-loading')
						const successMessage = document.querySelector('.js-success-message')
						const errorMessage = document.querySelector('.js-error-message')
						const errorDuplicateEmail = document.querySelector('.js-error-duplicate')

						const instructions = document.querySelector('.instructions')
						const map = document.querySelector('.gllpMap')
						const SeeMap = document.querySelector('.SeeMap')

						var emails = []
						var currentEmail = ""

						// user email copy hack
						function copyUserEmail(f) {
							// getElementById('userEmailMobile').value = getElementById('userEmail').value;
							f.name.value = f.emailMobile.value;
						}
						
						

						//click to reveal map

						
						function showMap () {
							instructions.classList.add('is-hidden')
							map.classList.remove('is-hidden')
							SeeMap.classList.remove('is-hidden')
						}

						function showMapInstructions () {
							map.classList.add('is-hidden')
							SeeMap.classList.add('is-hidden')
							instructions.classList.remove('is-hidden')
						}
						
						form.addEventListener('submit', e => {

							var emailMatched = 

							e.preventDefault()

							getCurrentEmail()
							emailMatches()
								// Push the Boolean response to emailMatched var
							// 	console.log(emails.every(emailMatches));
							// emailMatched = emails.every(emailMatches);

							console.log(emails.includes(currentEmail));
							emailMatched = emails.includes(currentEmail)
								

							compareEmails()
							showLoadingIndicator()
							// fetch(scriptURL, { method: 'POST', body: new FormData(form)})
							// 	.then(response => showSuccessMessage(response))
							// 	.catch(error => showErrorMessage(error))

							//Compare currentEmail to array 
							function compareEmails(){
								//Compare
							// for (i=0; i < emails.length; i++){
							// console.log(emails[i]);
							// //if there is a match show error message
							// if (currentEmail == emails[i]) {
							// 	console.log("uh oh there's a match")
							// 	showErrorDuplicateEmail();
							// 	//if no matching emails Post data and show success Message
							// 	} else {
							// 		console.log("good no matching emails")
							// 		fetch(scriptURL, { method: 'POST', body: new FormData(form)})
							// 	.then(response => showSuccessMessage(response))
							// 	.catch(error => showErrorMessage(error))
							// 	}
	
							// }

							
							
							//if there is a match show error message
							if (emailMatched === true) {
								console.log("uh oh there's a match")
								showErrorDuplicateEmail();
								//if no matching emails Post data and show success Message
								} else if (emailMatched === false){
									console.log("good no matching emails")
									fetch(scriptURL, { method: 'POST', body: new FormData(form)})
								.then(response => showSuccessMessage(response))
								.catch(error => showErrorMessage(error))
								}

							

						}
							
						})

						// var getData = () => {
						// 	fetch(scriptURL, { method: 'GET', body: FormData(form)})
						// 		console.log ("fetched")
						// }

						function showLoadingIndicator () {
							page.classList.add('is-hidden')
							loading.classList.remove('is-hidden')
						}
				
						function showSuccessMessage (response) {
							console.log('Success!', response, FormData)
							setTimeout(() => {
								successMessage.classList.remove('is-hidden')
								loading.classList.add('is-hidden')
							}, 500)
						}
				
						function showErrorMessage (error) {
							console.error('Error!', error.message)
							setTimeout(() => {
								errorMessage.classList.remove('is-hidden')
								loading.classList.add('is-hidden')
							}, 500)
						}

						function showErrorDuplicateEmail () {
							console.error('Error!')
							setTimeout(() => {
								errorDuplicateEmail.classList.remove('is-hidden')
								loading.classList.add('is-hidden')
							}, 500)
						}

// *************************************************************
						// data fetch to compare var currentEmail
// *************************************************************
						// ID of SpreadSheet
						// https://spreadsheets.google.com/feeds/list/1Q7OrRTByqyPn2sInibfRSkfTN1QtTolZTwR07L2QG3E/od6/public/basic?alt=json
						var spreadsheetID = "1Q7OrRTByqyPn2sInibfRSkfTN1QtTolZTwR07L2QG3E";

						// Make sure it is public or set to Anyone with link can view 
						var url = "https://spreadsheets.google.com/feeds/list/"+spreadsheetID+"/od6/public/values?alt=json";

						$.getJSON(url, function(data) {

							var entry = data.feed.entry;

							$(entry).each(function(){
								// Column names are name, age, etc.
								$('.results').prepend('<h2>'+this.content.$t+'</h2>');

								//Grab the submitted information
								var userInfo = this.content.$t

								//split the Info into an Array
								var userArray = userInfo.split(',')

								//grab the user email information
								var email = userArray[0]
								console.log("Array of emails: " + email);
								//push to emails arrary for comparison
								emails.push(email)

								// console.log($(this.content.$t).val().split(','))
							});

						});

// *************************************************************
						//End  data fetch to compare var currentEmail
// *************************************************************


// *************************************************************
						//Get the user input and put it in the currentEmail 
// *************************************************************
						// push user input into var currentEmail
						function getCurrentEmail(){
							var text = document.getElementById("userEmail").value;
							console.log(text)
							currentEmail = 'email: ' + text

						}
// *************************************************************
						//End Get the user input and put it in the currentEmail 
// *************************************************************


// *************************************************************
						//compare for matches return a Boolean
// *************************************************************
						//Check to see if any of the emails matched
						function emailMatches (currentValue) {
							console.log("this is currentValue: " + currentValue);
								return currentValue == currentEmail;
							}	
// *************************************************************
						//compare for matches return a Boolean
// *************************************************************	

						//Compare currentEmail to array 
						// function compareEmails(){
						// 	for (i=0; i < emails.length; i++){
						// 	console.log(emails[i]);
						// 	if (currentEmail == emails[i]) {
						// 		console.log("uh oh there's a match")
						// 		} else {
						// 			console.log("good no matching emails")
						// 		}
	
						// 	}
						// }
						



						// TODO: compare duplicate emails
						// TODO: send Message to user
						// TODO: Remove most recent entry from spreadsheet

					</script>
				
</body>
<script>
	
</script>
</html>
