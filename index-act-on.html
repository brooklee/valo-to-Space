<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
	<title>VALO in Space</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<meta name="viewport" content="width=device-width">

	<!-- Tailwind -->
	<!-- <link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet"> -->




	<!-- Dependencies: JQuery and GMaps API should be loaded first -->
	<script src="https://cdn.jsdelivr.net/gh/brooklee1/valo-to-Space/js/jquery-2.1.1.min.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCyrJDHTdAiCLZqF0XgLP_PA0d7gmVEoAA&sensor=false"></script>



	<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh//brooklee1/valo-to-Space/css/valo-space.css"/>
	<script src="https://cdn.jsdelivr.net/gh/brooklee1/valo-to-Space/js/jquery-gmaps-latlon-picker.js"></script>
	<!-- <script src="js/valo-scripts.js"></script> -->
	<style>
		.grid-container {
    display: grid;
}

.grid-container--fill {
    grid-template-columns: repeat(auto-fill, minmax(500px, 1fr));
}

.grid-container--fit {
    grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
}

.grid-element {
  
  padding: 20px;
}

.center-grid-container{
	height: 100%;
  display: grid;
}

.center-me{
	margin: auto;
}

	</style>

	<script>		
	</script>
</head>

<!-- aria-label="LONG" -->

<!-- AJAX Request sent to -->
<!-- https://script.google.com/macros/s/AKfycbx3vNK9UjmmDV7toGNM9I7J6DuccAYsXlBAbxaj3GoUS-Rup7c/exec -->

<body class="stars" >
	
	<!-- Main Page -->
	<div class="page-hide ">
			<div class="grid-container grid-container--fit">
					<div class="grid-element">
						<img src="https://images.ctfassets.net/wfptrcrbtkd0/5ChXBRW6l5GGEUBe7JNJOT/ac99c96f070732d4f1e32bd149f76400/Valo_Logo_White_2019.svg" class="logo">
						<h1> Can you guess where the <span style="font-weight: 700;">VALO<sup>&trade;</sup></span> light landed?</h1>
						<p>2019 marks the VALO curing lightâ€™s 10th anniversary, and to celebrate, we sent a VALO light into space! Guess where it landed for your chance to <span style="font-weight: 700;"">win a VALO light for 99 cents!</span> Just click where you think it landed on the map below and then enter in your office information. Whoever guesses the closest location wins a VALO curing light!</p>

						</div>
			</div>
			<fieldset class="gllpLatlonPicker">
					
					<div class="grid-container grid-container--fit">
							<div class="grid-element">
									<div onclick="showMap()" class ="instructions ">
											<img src="https://images.ctfassets.net/wfptrcrbtkd0/34EZgoMhHXiDRfAwqCUdzR/9677622f1bf925fc987aac8a99b0ab32/Map_Gif_Instructions_V2.gif" style="width:100%;">
										</div>
									<div  class="gllpMap is-hidden ">Google Maps</div>

									<p onclick="showMapInstructions()" class="SeeMap is-hidden button">See Map Instructions Again</p>
										<h2>Helpful Map Hints</h2>
									<p> 1. The form autopopulates latitude and longitude from the map.
											<br><br>
											2. The marker starts at lift-off.
											<br><br>
											3. Hint: Stay west of the Mississippi river and east of California.</p>
									<br><br>
									<p>Contest begins October 14, 2019 8:00 a.m. MDT and ends October 15, 11:59 p.m. MDT. Winner must claim prize within 24 hours. Winner will be contacted by email or phone. We will not share any of your information.</p>

									<br/>
				
							</div>
							<div class="grid-element">
									<div class="form-container">
											<form name="submit-to-google-sheet">
												<p class="form-title">Email</p>
												<input id="userEmail" name="email" type="email" placeholder="Email" required>
												<p class="form-title">First Name</p>
												<input name="firstName" type="text" placeholder="First Name" required>
												<p class="form-title">Last Name</p>
												<input name="lastName" type="text" placeholder="Last Name" required>
				
												<div class="form-map">
														<p class="form-title">Latitude</p>
														<input class="gllpLatitude" name="LAT" value="40.5657534" type="text" placeholder="Lattitude" required>
														<p class="form-title">Longitude</p>
														<input class="gllpLongitude" value="-111.9062161" name="LONG" type="text" placeholder="Longitude" required>
				
														<input  type="button" class="gllpUpdateButton" value="update map">
												</div>
											
												<p class="form-title">Office</p>
												<p class="form-title"></p>
												<input name="office" type="text" placeholder="Office Name" required>
												<!-- <p class="form-title">City</p>
												<input name="city" type="text" placeholder="city" required> -->
												<p class="form-title">Phone</p>
												<input name="phone" type="text" placeholder="Phone" required>
												<p class="form-title">Country</p>
												<!-- <input name="country" type="text" placeholder="Country" required> -->
												<select class="select-country"  name="country" required>
														<option value="United States of America">United States of America</option>
														<option value="LATAM - Argentina">Argentina</option>
														<option value="ASIAPAC - Australia">Australia</option>
														<option value="Northern Europe - Austria">Austria</option>
														<option value="ASIAPAC - Bangladesh">Bangladesh</option>
														<option value="Northern Europe - Belgium">Belgium</option>
														<option value="LATAM - Bolivia">Bolivia</option>
														<option value="Brazil">Brazil</option>
														<option value="Canada">Canada</option>
														<option value="LATAM - Chile">Chile</option>
														<option value="LATAM - Colombia">Colombia</option>
														<option value="LATAM - Costa Rica">Costa Rica</option>
														<option value="Northern Europe - Denmark">Denmark</option>
														<option value="LATAM - Dominican Republic">Dominican Republic</option>
														<option value="LATAM - Ecuador">Ecuador</option>
														<option value="LATAM - El Salvador">El Salvador</option>	
														<option value="Northern Europe - Finland">Finland</option>
														<option value="Northern Europe - Germany">Germany</option>
														<option value="ASIAPAC - Guam">Guam</option>
														<option value="LATAM - Honduras">Honduras</option>
														<option value="ASIAPAC - Hong Kong">Hong Kong</option>
														<option value="ASIAPAC - India">India</option>
														<option value="ASIAPAC - Indonesia">Indonesia</option>
														<option value="LATAM - Jamaica">Jamaica</option>
														<option value="Japan">Japan</option>
														<option value="ASIAPAC - Kenya">Kenya</option>
														<option value="ASIAPAC - Malaysia">Malaysia</option>
														<option value="ASIAPAC - Mauritius">Mauritius</option>
														<option value="LATAM - Mexico">Mexico</option>
														<option value="ASIAPAC - Myanmar">Myanmar</option>
														<option value="ASIAPAC - Namibia">Namibia</option>
														<option value="Northern Europe - Netherlands">Netherlands</option>
														<option value="ASIAPAC - New Zealand">New Zealand</option>
														<option value="LATAM - Nicaragua">Nicaragua</option>
														<option value="ASIAPAC - Nigeria">Nigeria</option>
														<option value="Northern Europe - Norway">Norway</option>
														<option value="Northern Europe - Oman">Oman</option>
														<option value="LATAM - Panama">Panama</option>
														<option value="LATAM - Paraguay">Paraguay</option>
														<option value="LATAM - Peru">Peru</option>
														<option value="ASIAPAC - Philippines">Philippines</option>
														<option value="LATAM - Puerto Rico">Puerto Rico</option>
														<option value="ASIAPAC - Senegal">Senegal</option>
														<option value="ASIAPAC - South Africa">South Africa</option>
														<option value="ASIAPAC - South Korea">South Korea</option>
														<option value="ASIAPAC - Sri Lanka">Sri Lanka</option>
														<option value="Northern Europe - Sweden">Sweden</option>
														<option value="Northern Europe - Switzerland">Switzerland</option>
														<option value="ASIAPAC - Taiwan">Taiwan</option>
														<option value="ASIAPAC - Thailand">Thailand</option>
														<option value="LATAM - Trinidad">Trinidad</option>
														<option value="ASIAPAC - Uganda">Uganda</option>
														<option value="LATAM - Uruguay">Uruguay</option>	
														<option value="LATAM - Venezuela">Venezuela</option>
														<option value="ASIAPAC - Vietnam">Vietnam</option>
													</select>
													<br>
													<input style="width: auto;" type="checkbox" name="agree" value="agree" required
													oninvalid="this.setCustomValidity('Please agree to Terms and Conditions')"
													oninput="setCustomValidity('')"
													> I agree and have read the <a href="https://assets.ctfassets.net/wfptrcrbtkd0/5Q8ELKbxuc9nrGlO9zIKIs/3332628a2a1b7899d47fcd18b29b83d8/Valo_to_Space_Contest_Rules.pdf" target="_blank">Terms and Conditions</a><br><br>
													<input style="width: auto;" type="checkbox" name="agree" value="agree" required
													oninvalid="this.setCustomValidity('Please confirm')"
													oninput="setCustomValidity('')"
													> I confirm that I am a licensed dentist in good standing and authorized to practice dentistry under the laws and regulations of the country where I reside.<br><br>
												<input style="display: none;" type="text" class="gllpZoom" value="7"/>
												<button id="submit" class="button" type="submit">Submit</button>
											</form>
									
											<div class="loading js-loading is-hidden">
												<div class="loading-spinner">
													<svg><circle cx="25" cy="25" r="20" fill="none" stroke-width="2" stroke-miterlimit="10"/></svg>
												</div>
											</div>
									
											<!-- <p class="js-success-message is-hidden form-message">Success!</p> -->
											<!-- <p class="js-error-message is-hidden form-message">Error!</p>
											<p class="js-error-duplicate is-hidden form-message">Sorry only one entry per person! You can have 3 diffrent people from the same office enter just be sure to use a diffrent email per entry.</p> -->
										</div>
							</div>
						 
						</div>
	
			</fieldset>
	</div>
	
		

	<!-- Success Message -->
		<div class="js-success-message is-hidden grid-container grid-container--fit">

				<div class="grid-element">
						<div>
								<img src="https://images.ctfassets.net/wfptrcrbtkd0/5ChXBRW6l5GGEUBe7JNJOT/ac99c96f070732d4f1e32bd149f76400/Valo_Logo_White_2019.svg" class="logo">

								<h1>Thank You!</h1>
							
									
									
								<p style="text-align: center;">Weâ€™ve recorded your pin drop!</p>
									<br><br>
										<p style="text-align: center;"><a class="link-button" href="https://www.ultradent.com/products/categories/equipment/curing-lights">Shop VALO</a></p>
										<br><br>
										<p>Contest begins October 14, 2020 8:00 a.m. MDT and ends, October 15, 11:59 p.m. MDT. Winner must claim prize within 24 hours. Winner will be contacted by email or phone. We will not share any of your information.</p>

								<br/>
						</div>
						</div>
						
					 
					</div>
<!-- Err Message  One Entry-->
				<div class="js-error-duplicate is-hidden center-grid-container">

				<div class="center-me">
						<div>
							<img src="https://images.ctfassets.net/wfptrcrbtkd0/5ChXBRW6l5GGEUBe7JNJOT/ac99c96f070732d4f1e32bd149f76400/Valo_Logo_White_2019.svg" class="logo">
							<h1>Oh No!</h1>
							<p style="text-align: center;">Sorry only one entry per person!</p>
							<br>
							<br>
							<p style="text-align: center;"><a class="link-button" href="https://www.ultradent.com/products/categories/equipment/curing-lights">Shop VALO</a><a class="link-button" href=".">Try Again</a></p>
							<br>
							<br>
							</div>
				</div>

				
		</div>

		</div>
		<!-- General Error -->
		<div class="js-error is-hidden"  id="center">

				<div id="main">
						<div>
							<img src="https://images.ctfassets.net/wfptrcrbtkd0/5ChXBRW6l5GGEUBe7JNJOT/ac99c96f070732d4f1e32bd149f76400/Valo_Logo_White_2019.svg" class="logo">
							<h1> Oh No!</h1>
							<p class="center">There was a problem submitting your entry please try submitting again later!</p>
							<br>
							<br>
							<p class="center"><a class="link-button" href="https://www.ultradent.com/products/categories/equipment/curing-lights">Shop VALO</a><a class="link-button" href=".">Try Again</a></p>
							</div>
				</div>

				
		</div>



<!-- *****************************************-->
<!-- *****************************************-->
		<!-- DANGER ZONE BELOW -->
<!-- DO NOT MAKE CHANGES PAST THIS MESSAGE -->
<!-- *****************************************-->
<!-- *****************************************-->
					<script>
						const scriptURL = 'https://script.google.com/macros/s/AKfycbyI8Xr6LKoFPmV2c1eq6SR-2WDcAcTIBFxjX8XH5BBlKQGOst4/exec'
						const form = document.forms['submit-to-google-sheet']
						const page = document.querySelector('.page-hide')
						const loading = document.querySelector('.js-loading')
						const successMessage = document.querySelector('.js-success-message')
						const errorMessage = document.querySelector('.js-error-message')
						const errorDuplicateEmail = document.querySelector('.js-error-duplicate')

						const instructions = document.querySelector('.instructions')
						const map = document.querySelector('.gllpMap')
						const SeeMap = document.querySelector('.SeeMap')

						var emails = []
						var currentEmail = ""

						// user email copy hack
						function copyUserEmail(f) {
							// getElementById('userEmailMobile').value = getElementById('userEmail').value;
							f.name.value = f.emailMobile.value;
						}
						
						

						//click to reveal map

						
						function showMap () {
							instructions.classList.add('is-hidden')
							map.classList.remove('is-hidden')
							SeeMap.classList.remove('is-hidden')
						}

						function showMapInstructions () {
							map.classList.add('is-hidden')
							SeeMap.classList.add('is-hidden')
							instructions.classList.remove('is-hidden')
						}
						
						form.addEventListener('submit', e => {

							var emailMatched = 

							e.preventDefault()

							getCurrentEmail()
							emailMatches()
								// Push the Boolean response to emailMatched var
							// 	console.log(emails.every(emailMatches));
							// emailMatched = emails.every(emailMatches);

							console.log(emails.includes(currentEmail));
							emailMatched = emails.includes(currentEmail)
								

							compareEmails()
							showLoadingIndicator()
							// fetch(scriptURL, { method: 'POST', body: new FormData(form)})
							// 	.then(response => showSuccessMessage(response))
							// 	.catch(error => showErrorMessage(error))

							//Compare currentEmail to array 
							function compareEmails(){
								//Compare
							// for (i=0; i < emails.length; i++){
							// console.log(emails[i]);
							// //if there is a match show error message
							// if (currentEmail == emails[i]) {
							// 	console.log("uh oh there's a match")
							// 	showErrorDuplicateEmail();
							// 	//if no matching emails Post data and show success Message
							// 	} else {
							// 		console.log("good no matching emails")
							// 		fetch(scriptURL, { method: 'POST', body: new FormData(form)})
							// 	.then(response => showSuccessMessage(response))
							// 	.catch(error => showErrorMessage(error))
							// 	}
	
							// }

							
							
							//if there is a match show error message
							if (emailMatched === true) {
								console.log("uh oh there's a match")
								showErrorDuplicateEmail();
								//if no matching emails Post data and show success Message
								} else if (emailMatched === false){
									console.log("good no matching emails")
									fetch(scriptURL, { method: 'POST', body: new FormData(form)})
								.then(response => showSuccessMessage(response))
								.catch(error => showErrorMessage(error))
								}

							

						}
							
						})

						// var getData = () => {
						// 	fetch(scriptURL, { method: 'GET', body: FormData(form)})
						// 		console.log ("fetched")
						// }

						function showLoadingIndicator () {
							page.classList.add('is-hidden')
							loading.classList.remove('is-hidden')
						}
				
						function showSuccessMessage (response) {
							console.log('Success!', response, FormData)
							setTimeout(() => {
								successMessage.classList.remove('is-hidden')
								loading.classList.add('is-hidden')
							}, 500)
						}
				
						function showErrorMessage (error) {
							console.error('Error!', error.message)
							setTimeout(() => {
								errorMessage.classList.remove('is-hidden')
								loading.classList.add('is-hidden')
							}, 500)
						}

						function showErrorDuplicateEmail () {
							console.error('Error!')
							setTimeout(() => {
								errorDuplicateEmail.classList.remove('is-hidden')
								loading.classList.add('is-hidden')
							}, 500)
						}

// *************************************************************
						// data fetch to compare var currentEmail
// *************************************************************
						// ID of SpreadSheet
						// https://spreadsheets.google.com/feeds/list/1Q7OrRTByqyPn2sInibfRSkfTN1QtTolZTwR07L2QG3E/od6/public/basic?alt=json
						var spreadsheetID = "1Q7OrRTByqyPn2sInibfRSkfTN1QtTolZTwR07L2QG3E";

						// Make sure it is public or set to Anyone with link can view 
						var url = "https://spreadsheets.google.com/feeds/list/"+spreadsheetID+"/od6/public/values?alt=json";

						$.getJSON(url, function(data) {

							var entry = data.feed.entry;

							$(entry).each(function(){
								// Column names are name, age, etc.
								$('.results').prepend('<h2>'+this.content.$t+'</h2>');

								//Grab the submitted information
								var userInfo = this.content.$t

								//split the Info into an Array
								var userArray = userInfo.split(',')

								//grab the user email information
								var email = userArray[0]
								console.log("Array of emails: " + email);
								//push to emails arrary for comparison
								emails.push(email)

								// console.log($(this.content.$t).val().split(','))
							});

						});

// *************************************************************
						//End  data fetch to compare var currentEmail
// *************************************************************


// *************************************************************
						//Get the user input and put it in the currentEmail 
// *************************************************************
						// push user input into var currentEmail
						function getCurrentEmail(){
							var text = document.getElementById("userEmail").value;
							console.log(text)
							currentEmail = 'email: ' + text

						}
// *************************************************************
						//End Get the user input and put it in the currentEmail 
// *************************************************************


// *************************************************************
						//compare for matches return a Boolean
// *************************************************************
						//Check to see if any of the emails matched
						function emailMatches (currentValue) {
							console.log("this is currentValue: " + currentValue);
								return currentValue == currentEmail;
							}	
// *************************************************************
						//compare for matches return a Boolean
// *************************************************************	

						//Compare currentEmail to array 
						// function compareEmails(){
						// 	for (i=0; i < emails.length; i++){
						// 	console.log(emails[i]);
						// 	if (currentEmail == emails[i]) {
						// 		console.log("uh oh there's a match")
						// 		} else {
						// 			console.log("good no matching emails")
						// 		}
	
						// 	}
						// }
						



						// TODO: compare duplicate emails
						// TODO: send Message to user
						// TODO: Remove most recent entry from spreadsheet

					</script>
				
</body>
<script>
	
</script>
</html>
